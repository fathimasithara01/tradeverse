<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Admin Profile</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/sidebar.css">
    <link rel="stylesheet" href="/static/admin_profile.css">
    <style>
        /* Optional: Add specific styles for the view page if needed */
        .profile-info-label {
            font-weight: 600;
            color: #555;
        }

        .profile-info-value {
            color: #333;
            margin-bottom: 1rem;
            word-wrap: break-word; /* For long emails/names */
        }
        .loading-overlay {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.8);
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 10;
            border-radius: .375rem;
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            visibility: hidden;
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        {{template "admin_sidebar" .}}

        <main class="content-area">
            <div class="container py-4">
                <div class="row justify-content-center">
                    <div class="col-md-8">
                        <div class="card shadow-sm position-relative">
                            <!-- Loading Overlay -->
                            <div class="loading-overlay" id="cardLoadingOverlayView" role="status"
                                aria-label="Loading profile data">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                            </div>

                            <div
                                class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                                <h1 class="mb-0 fs-4">Admin Profile</h1>
                                <a href="/admin/profile/edit" class="btn btn-outline-light btn-sm" id="editProfileBtn">
                                    <i class="fas fa-edit"></i> Edit Profile
                                </a>
                            </div>
                            <div class="card-body">
                                <!-- Profile Load Message -->
                                <div id="profile-message-view" class="alert d-none" role="status" aria-live="polite">
                                    <!-- Messages like "Failed to load profile" will appear here -->
                                </div>

                                <div class="text-center mb-4">
                                    <div class="profile-pic-wrapper">
                                        <img id="profilePicDisplay" src="/static/images/default_profile_pic.png"
                                            alt="Admin Profile Picture"
                                            class="profile-pic-preview img-thumbnail rounded-circle">
                                    </div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label profile-info-label">Name:</label>
                                    <p class="profile-info-value" id="displayName">Loading...</p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label profile-info-label">Email:</label>
                                    <p class="profile-info-value" id="displayEmail">Loading...</p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label profile-info-label">Phone:</label>
                                    <p class="profile-info-value" id="displayPhone">Not provided</p>
                                </div>
                                <div class="mb-3">
                                    <label class="form-label profile-info-label">Member Since:</label>
                                    <p class="profile-info-value" id="displayMemberSince">Loading...</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Bootstrap JS (bundle includes Popper) -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
        crossorigin="anonymous"></script>

    <!-- Your custom JavaScript for view page -->
    <script>
        (function () {
            const DOM = {
                cardLoadingOverlay: document.getElementById('cardLoadingOverlayView'),
                profilePicDisplay: document.getElementById('profilePicDisplay'),
                displayName: document.getElementById('displayName'),
                displayEmail: document.getElementById('displayEmail'),
                displayPhone: document.getElementById('displayPhone'),
                displayMemberSince: document.getElementById('displayMemberSince'),
                profileMessageDiv: document.getElementById('profile-message-view'),
                editProfileBtn: document.getElementById('editProfileBtn'),
            };

            const API_ENDPOINTS = {
                PROFILE: '/admin/api/profile',
            };

            const DEFAULT_PROFILE_PIC = '/static/images/default_profile_pic.png';
            const MESSAGE_TIMEOUT_MS = 5000;

            const toggleLoadingOverlay = (show) => {
                if (DOM.cardLoadingOverlay) {
                    DOM.cardLoadingOverlay.classList.toggle('active', show);
                }
            };

            const showAlert = (alertDiv, type, message) => {
                if (!alertDiv) return;
                alertDiv.className = 'alert';
                alertDiv.classList.add(`alert-${type}`);
                alertDiv.textContent = message;
                alertDiv.setAttribute('role', 'alert');
                alertDiv.classList.remove('d-none', 'fade', 'show');
                void alertDiv.offsetWidth;
                alertDiv.classList.add('show');
                clearTimeout(alertDiv.dataset.hideTimeout);
                alertDiv.dataset.hideTimeout = setTimeout(() => {
                    alertDiv.classList.remove('show');
                    alertDiv.classList.add('fade');
                    const handleTransitionEnd = () => {
                        alertDiv.classList.add('d-none');
                        alertDiv.classList.remove('fade');
                        alertDiv.removeEventListener('transitionend', handleTransitionEnd);
                    };
                    alertDiv.addEventListener('transitionend', handleTransitionEnd, { once: true });
                }, MESSAGE_TIMEOUT_MS);
            };

            const clearAlert = (alertDiv) => {
                if (alertDiv) {
                    clearTimeout(alertDiv.dataset.hideTimeout);
                    alertDiv.classList.add('d-none');
                    alertDiv.classList.remove('show', 'fade');
                    alertDiv.removeAttribute('role');
                    alertDiv.textContent = '';
                }
            };

            async function fetchJson(url, options = {}) {
                try {
                    const response = await fetch(url, options);
                    const data = await response.json();
                    if (!response.ok) {
                        const errorMessage = data.error || data.message || `HTTP error! Status: ${response.status}`;
                        throw new Error(errorMessage);
                    }
                    return data;
                } catch (error) {
                    throw error;
                }
            }

            async function fetchAndDisplayAdminProfile() {
                toggleLoadingOverlay(true);
                clearAlert(DOM.profileMessageDiv);

                try {
                    const data = await fetchJson(API_ENDPOINTS.PROFILE + '/view'); // Note: Using a specific view API
                    DOM.displayName.textContent = data.name || 'N/A';
                    DOM.displayEmail.textContent = data.email || 'N/A';
                    DOM.displayPhone.textContent = data.phone || 'Not provided';
                    DOM.profilePicDisplay.src = data.profile_pic ? data.profile_pic : DEFAULT_PROFILE_PIC;

                    if (data.created_at) {
                        const date = new Date(data.created_at);
                        DOM.displayMemberSince.textContent = date.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
                    } else {
                        DOM.displayMemberSince.textContent = 'N/A';
                    }

                } catch (error) {
                    console.error('Error fetching admin profile for view:', error);
                    showAlert(DOM.profileMessageDiv, 'danger', `Failed to load profile: ${error.message}`);
                    DOM.displayName.textContent = 'Error loading profile';
                    DOM.displayEmail.textContent = 'Error loading profile';
                    DOM.displayPhone.textContent = 'Error loading profile';
                    DOM.displayMemberSince.textContent = 'Error loading profile';
                    DOM.profilePicDisplay.src = DEFAULT_PROFILE_PIC;
                } finally {
                    toggleLoadingOverlay(false);
                }
            }

            document.addEventListener('DOMContentLoaded', () => {
                fetchAndDisplayAdminProfile();
            });

        })();
    </script>
</body>

</html>